# 회고 기록 - 2025-05-02

# 당시 작업 내용

## 문제상황
- stm32f407g-disco 보드의 5v,gnd에 5v의 외부전원을 인가 -> 5v,gnd 핀 부족으로 인해 breadboard로 확장시켜서 servo모터의 5v,gnd와 dc motor의 encoder 5v,gnd의 전원을 공급해줌 -> encoder의 전원 led 점등 확인 및 dc모터 동작확인, 서보모터 동작확인
-> stm32f407보드에서 연기발생 및 "타닥"하는 소리가 들림 -> 외부전원 제거 후 usb의 전원으로 확인 결과 전원회로 손상으로 판단

- f407 전원회로 손상 의심 원인
1. f407의 5v 핀에 5v 이상의 과전압이 흘렀나? -> x, 멀티미터로 확인결과 5v로 측정됨 
2. 5v, gnd 선을 잘못 연결해서 단락이 된건가? -> x, 점퍼케이블 색을 빨강,검정으로 명확히 했기 때문에 가능성 거의 희박
3. 상대적으로 큰 전류를 요구하는 mg996r 서보모터의 전원과 엔코더의 전원을 stm32보드의 5v에 같이 연결해서 과전류로 인해 보호회로/정전류 회로가 없는 stm32 보드가 손상된건가? -> 가장 가능성 농후

## 해결 방안

1. 메인보드 변경
- stm32f407g-disco 보드 -> stm2f446re로 변경
stm32f446re로 변경 이유 : 기존에 사용하던 STM32F407 보드가 하드웨어 손상으로 더 이상 사용이 어려워, 기능적으로 유사한 STM32F446RE 보드로 대체하였음. F446RE는 CAN 컨트롤러가 내장되어 있고, FreeRTOS 기반의 멀티태스킹 운영과 실시간 제어에 필요한 충분한 성능과 리소스를 제공하기 때문에 본 프로젝트의 요구사항을 충족하는 데 적합하다고 판단

2. 로직 레벨 시프터 추가
- dc 모터의 encoder의 입력을 외부전원인 5v로 줄 것이기 때문에 A,B선의 출력 신호도 출력도 5v일 것이므로 입력한계가 3.6v 최대인 stm32보드에 3.3v로 shift를 해주는 로직 레벨 시프터를 추가하여 회로를 보호

3. servo모터의 전원을 스텝다운 컨버터의 output에 물려줌
- 서보모터의 소비 전류를 감당하기 위해 stm32의 5v,gnd 핀이 아닌 외부전원에 연결

## 특이사항
- stm32의 5v 핀은 전류 공급원이 아닌 신호 공급원으로 이해해야하며, 고출력은 외부전원으로 직접 받아야함
- 인코더의 전원을 외부전원 5v로 인가하는 경우, stm32보드와 인코더의 gnd는 반드시 공통 접지로 연결해야함 (그렇지 않으면 신호 레벨 기준점이 달라져서 stm32가 인코더의 출력(A,B)을 정확하게 인식하지 못하거나 오작동할 수 있음)
