# 수신부 보드 전환 후 RF 수신 실패 문제

## 개요
- 기존에는 **STM32F103C8T6(M3)** 기반의 송수신 구조에서 `nRF24L01+ PA+LNA` 무선 모듈을 통해 데이터 송수신이 정상적으로 이루어졌음  
- 이후 **수신부 MCU를 STM32F446RE(M4)**로 교체하고, **기존과 동일한 nRF24 통신 초기화 및 코드**를 이식하였으나 데이터 수신이 되지 않는 문제가 발생함
- CubeMX 설정은 SPI1(5.625Mbps), EXTI3(PC3, IRQ 인터럽트), CE/CSN 핀 등 동일하게 구성되었으며, **기존 M3에서 사용하던 IRQ 핀 PB3를 PC3(EXTI3)으로 변경**함
- 송신부와 수신부 간 주소 및 채널 설정은 동일하게 유지됨

## 문제 상황

1. 수신부 MCU를 M3에서 M4(STM32F446RE)로 변경한 이후, 수신 이벤트가 더 이상 발생하지 않음
2. 기존과 동일한 코드, 동일한 통신 설정(SPI 속도, 채널, 주소 등)을 사용하였음에도 **HAL_GPIO_EXTI_Callback() 진입 없음**
3. 송신부는 정상적으로 데이터를 전송하고 있는 상태이며, 수신부 OLED 출력은 초기화 성공함
4. nRF24 모듈의 CE, CSN, IRQ 핀은 CubeMX에서 명시적으로 설정되었고 SPI 핀의 Alternate Function 또한 확인함
5. IRQ 핀인 PC3가 물리적으로 정확히 연결되어 있음에도 인터럽트가 트리거되지 않음

## 문제 원인 추정

- 현재 상황은 단순 코드나 설정 오류가 아닌, **M3와 M4의 구조적 차이에서 기인한 인터럽트 미진입 현상**으로 판단됨

- 주요 원인 후보:
  - **IRQ 핀(PC3)의 EXTI3 인터럽트 설정 누락** 가능성 (NVIC 미체크, GPIO Mode 설정 누락 등)
  - CubeMX 상에서 **PC3 핀의 GPIO Mode가 Input + External Interrupt 모드로 정확히 설정되지 않았을 가능성**
  - `HAL_GPIO_EXTI_Callback()` 함수가 존재하더라도 **NVIC에서 EXTI3 인터럽트 활성화가 누락되면 콜백 진입하지 않음**
  - SPI 통신은 정상이나, **nRF24L01+의 수신 완료 신호를 받지 못함으로 인해 이후 로직이 미동작**

- 그 외 고려된 가능성:
  - SPI 속도 설정 불일치 (그러나 양쪽 모두 정상 범위: 4.5Mbps vs 5.625Mbps)
  - CE 핀 제어 미동작 (확인 결과 정상 설정)
  - 전원 공급 불안정 (nRF24L01+ PA+LNA의 고전류 요구사항은 확인 중)

## 향후 계획

- **IRQ 인터럽트 핀(PC3) 단독 테스트** 진행: `HAL_GPIO_EXTI_Callback()` 진입 여부 LED로 확인
- **STATUS 레지스터 수동 조회**를 통해 SPI 통신이 실제로 되는지 확인 (`nrf24_read_reg(STATUS)`)
- **CubeMX NVIC 설정, GPIO Mode 설정 재검토 및 수정**
- 필요 시 **IRQ 우선순위 재조정 (EXTI3 Priority 0)** 및 `__HAL_GPIO_EXTI_CLEAR_IT()` 직접 호출 여부 점검
- 만약 IRQ를 통한 동작이 계속 실패할 경우, **Polling 방식 수신 대안 로직** 구성 검토
