# CubeIDE Git 버전 전환 후 펌웨어 비정상 동작 문제
 
## 개요  
- 기존에는 STM32 CubeIDE 환경에서 Git으로 프로젝트 버전 관리를 하고 있었음

- FreeRTOS를 통합한 버전에서 개발을 진행하다가, RTOS 통합 이전 버전으로 되돌아가야 할 필요가 생김

- Git을 이용해 이전 버전의 소스 코드를 현재 프로젝트 폴더에 단순 덮어쓰기(Overwrite) 방식으로 복원함

- 복원 후 빌드 및 프로그래밍을 진행했으나, 펌웨어가 정상적으로 동작하지 않는 문제가 발생함

## 문제 상황
1. 이전 버전으로 되돌리기 위해, Git에서 해당 커밋의 소스 파일(Inc, Src 폴더 등)을 덮어쓰기함

2. 덮어쓰기 후에도 freertos.c, FreeRTOSConfig.h 등 RTOS 관련 파일이 프로젝트 폴더에 남아있는 것을 확인하고 수동으로 삭제함

3. 프로젝트를 다시 빌드하고 마이크로컨트롤러에 업로드했으나, main() 함수 내의 while(1) 무한 루프가 실행되지 않는 현상이 발생함 (시스템 초기화 중 멈춤으로 추정)

4. 반면, 프로젝트 폴더 전체를 삭제한 후 Git을 통해 이전 버전을 새로 Clone 또는 Checkout 하니 완벽하게 정상 동작함


## 문제 원인 추정
이 문제는 소스 코드 자체의 오류가 아닌, 소스 코드와 프로젝트 설정 간의 불일치에서 발생한 것으로 판단됨

> 주요 원인:

- 프로젝트 설정 파일(.cproject, .project)의 불일치: 소스 코드는 RTOS 이전 버전으로 돌아갔지만, CubeIDE의 프로젝트 설정 파일은 RTOS가 추가될 때 변경된 내용(e.g., #define USE_FREERTOS, RTOS 관련 Include 경로)을 그대로 유지하고 있었음

- 설정과 코드의 충돌: 컴파일러는 .cproject 파일의 설정에 따라 RTOS가 있는 것처럼 코드를 해석하고 빌드하려 하지만, 실제 소스 파일에는 RTOS 관련 함수(e.g., osKernelStart)의 호출부가 없어 시스템 초기화 과정에서 오류가 발생하거나 HardFault 핸들러로 진입하게 됨

- 단순 파일 삭제의 한계: 사용자가 소스 폴더에서 RTOS 관련 파일을 직접 지우더라도, 눈에 보이지 않는 프로젝트 설정 파일 내부의 의존성은 전혀 해결되지 않음

## 결론

- Git을 통한 단순 파일 덮어쓰기는 프로젝트의 모든 상태(특히, IDE가 관리하는 설정)를 완벽하게 되돌리지 못하며, 이로 인해 펌웨어 오작동을 유발함


- 근본적인 해결책: 문제가 발생한 폴더를 완전히 삭제하고, Git을 통해 원하는 시점의 버전을 새롭게 Clone 또는 Checkout 하여 깨끗한 상태에서 프로젝트를 여는 것이 가장 확실함

> 권장되는 버전 관리 방식:

1. 수동으로 변경 시 파일을 덮어쓰는 방식 X 삭제 후 대신

2. Git의 정식 명령어를 사용하여 작업 공간을 관리하는 방식도 차용 가능

    - git checkout <commit-hash> 명령어로 원하는 버전으로 소스 코드를 되돌림

    - git clean -fdx 명령어를 실행하여, 이전 버전에 없던 새로 생긴 파일 및 폴더(untracked files)를  
     모두 삭제하여 작업 공간을 완벽하게 정리함

    - 이 절차를 통해 소스 코드와 프로젝트 설정의 완전한 동기화를 보장하고 문제 발생을 예방함    
