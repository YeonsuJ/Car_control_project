# ⚠️ main 함수에서 while 루프를 주석 처리했을 때 MCU가 동작하지 않음

## 📌 문제 상황

임베디드 시스템에서 `main()` 함수 내의 `while(1)` 루프를 주석 처리하거나 제거한 후, MCU가 정상적으로 동작하지 않음.  
예: 디바이스가 초기화 이후 아무 작업도 수행하지 않음, 인터럽트도 동작하지 않음.

---

## 🧭 원인 분석

임베디드 시스템의 동작 방식과 MCU의 실행 흐름에 기초한 문제입니다.

### 1. MCU는 `main()` 함수가 종료되면 undefined behavior에 빠짐
- 대부분의 MCU는 `main()`이 종료되면 다시 리셋되거나 fault 상태에 빠짐.
- 운영체제가 없는 MCU 환경에서는 `main()` 이후의 흐름이 정의되어 있지 않음.

### 2. `while(1)` 루프는 시스템의 지속 동작을 보장하는 핵심 구조
- MCU는 전원이 들어오면 초기화 후, **루프를 통해 계속 상태를 점검하거나 동작을 반복 수행**해야 함.
- 루프가 없으면 초기화 후 할 일이 없기 때문에 멈추는 것처럼 보임.

### 3. 인터럽트 기반 시스템도 루프는 필요함
- 인터럽트는 비동기 이벤트 처리에만 적합하고, 시스템의 전체 흐름 제어나 상태 유지는 루프에서 수행됨.
- 루프 없이 인터럽트만 사용하는 시스템은 **불안정하며 유지보수에 취약**함.

### 4. RTOS 사용 시에도 `main()`이 종료되지 않도록 설계해야 함
- RTOS에서는 `vTaskStartScheduler()` 호출 이후 루프 없이 동작할 수 있음.
- 그러나 스케줄러가 리턴하는 경우는 예외 상황이므로, 보통 `while(1);`이나 에러 핸들링 코드가 뒤따름.

---
## ✅ 권장 해결 방법

### 🔧 `while(1)` 루프를 반드시 유지할 것

```c
int main(void)
{
    system_init();   // 시스템 초기화

    while(1)
    {
        main_loop_task();  // 주기적인 처리 또는 상태 점검
    }
}
```

```c
int main(void)
{
    init_peripherals();
    enable_interrupts();

    while(1)
    {
        // 이벤트 대기, 저전력 모드 진입, watchdog reset 등
    }
}
```
```
int main(void)
{
    system_init();   // 시스템 초기화

    while(1);
}
```
